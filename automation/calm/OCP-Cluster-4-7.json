{"status":{},"contains_secrets":false,"product_version":"3.2.1","spec":{"description":"","resources":{"client_attrs":{"9df14f84_deployment":{"y":-646.0253049295,"x":304.3927575272},"8ff9c0f1_deployment":{"y":-733.634849869,"x":-52.972252655},"decb8265_deployment":{"y":-571.7754956236,"x":135.2205188825},"d9d0f80c_deployment":{"y":-774.2688941119,"x":424.4684887834}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3b8701f6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"244932b5_runbook","main_task_local_reference":{"kind":"app_task","name":"3b8701f6_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"CHECK_VAR","value":"@@{Openshift_LB_DNS.LB_DNS_STATUS}@@","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3fddfa76_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3b982661_runbook","main_task_local_reference":{"kind":"app_task","name":"3fddfa76_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"267fcd78_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"292034ce_runbook","main_task_local_reference":{"kind":"app_task","name":"267fcd78_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5c64d685_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4fcf4ddc_runbook","main_task_local_reference":{"kind":"app_task","name":"5c64d685_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cb5d5768_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"06ce90e3_runbook","main_task_local_reference":{"kind":"app_task","name":"cb5d5768_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Boostrap","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BOOTSTRAP_STATUS","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COOKIE","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"68f2a41b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"afc7eb2c_runbook","main_task_local_reference":{"kind":"app_task","name":"68f2a41b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6a320be2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d8410e81_runbook","main_task_local_reference":{"kind":"app_task","name":"6a320be2_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"8826904c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ddbfb95a_runbook","main_task_local_reference":{"kind":"app_task","name":"8826904c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"569d8b62_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"44394b32_runbook","main_task_local_reference":{"kind":"app_task","name":"569d8b62_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"46a1155f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bd4aacc4_runbook","main_task_local_reference":{"kind":"app_task","name":"46a1155f_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MASTER_STATUS","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"df22df50_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"624885aa_runbook","main_task_local_reference":{"kind":"app_task","name":"df22df50_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b6b8e7f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c624baa4_runbook","main_task_local_reference":{"kind":"app_task","name":"b6b8e7f8_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"afbe47d3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"634da80b_runbook","main_task_local_reference":{"kind":"app_task","name":"afbe47d3_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c1e710f3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c5e9be4b_runbook","main_task_local_reference":{"kind":"app_task","name":"c1e710f3_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e9f29ce8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"84dbf71c_runbook","main_task_local_reference":{"kind":"app_task","name":"e9f29ce8_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"LB_DNS","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"ST","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c465827e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"96b11ed4_runbook","main_task_local_reference":{"kind":"app_task","name":"c465827e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"168fff19_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"27198955_runbook","main_task_local_reference":{"kind":"app_task","name":"168fff19_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Show Login Information"}],"name":"c516d21c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Show Login Information","attrs":{"script":"print \"Installation completed\"\nprint \"For logging into Console please use the following URL:\"\nprint \"https:\/\/console-openshift-console.apps.{}.{}\".format('@@{OPENSHIFT_SUBDOMAIN}@@','@@{BASE_DOMAIN}@@')\nprint \"Credentials: kubeadmin \/ {}\".format(base64.b64decode('@@{KUBEADMINB64}@@'))\nprint \"For CLI access you can also connect to LB_DNS-Console.\"\nprint \"Please run 'export KUBECONFIG=~\/openshift\/auth\/kubeconfig' before using OC CLI Tool\"\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"15c8346b_runbook","main_task_local_reference":{"kind":"app_task","name":"c516d21c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"715f1ce2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"afe012b6_runbook","main_task_local_reference":{"kind":"app_task","name":"715f1ce2_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"97a5f3ca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0b751606_runbook","main_task_local_reference":{"kind":"app_task","name":"97a5f3ca_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"OS_Status_Check","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"bootstrap"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create SubnetRef"}],"name":"dba0ce39_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"bootstrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create SubnetRef","attrs":{"exit_status":[],"script":"subnet_ref={\n                \"kind\": \"subnet\",\n                \"uuid\": \"@@{SUBNET_REF}@@\"\n              }\nprint 'subnet_ref=',json.dumps(subnet_ref)","eval_variables":["subnet_ref"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"355b875b_runbook","main_task_local_reference":{"kind":"app_task","name":"dba0ce39_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"bootstrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e74e8ced_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0d11456a_runbook","main_task_local_reference":{"kind":"app_task","name":"e74e8ced_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"bootstrap","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"120","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"editables":{"readiness_probe":{"retries":true,"delay_secs":true,"timeout_secs":null},"create_spec":{"resources":{"nic_list":{"0":{"subnet_reference":true}},"disk_list":{"1":{"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"Bootstrap-@@{calm_array_index}@@-@@{calm_time}@@-@@{LB_DNS.ST}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"@@{subnet_ref.uuid}@@"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":16384,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"e52890e9-d06b-4185-9e67-91dfb89457ce","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"RHCOS47_BOOTSTRAP","uuid":"fdf77ea2-f718-45e9-b823-7b0c7fb68330"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"},"device_type":"CDROM"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create SubnetRef"}],"name":"82055624_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create SubnetRef","attrs":{"exit_status":[],"script":"subnet_ref={\n                \"kind\": \"subnet\",\n                \"uuid\": \"@@{SUBNET_REF}@@\"\n              }\nprint 'subnet_ref=',json.dumps(subnet_ref)","eval_variables":["subnet_ref"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"01ba9557_runbook","main_task_local_reference":{"kind":"app_task","name":"82055624_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7fde6a8e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"797b9168_runbook","main_task_local_reference":{"kind":"app_task","name":"7fde6a8e_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"master","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"120","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"editables":{"readiness_probe":{"retries":true,"delay_secs":true,"timeout_secs":null},"create_spec":{"resources":{"nic_list":{"0":{"subnet_reference":true}},"disk_list":{"1":{"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"master-@@{calm_array_index}@@-@@{calm_time}@@-@@{LB_DNS.ST}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"@@{subnet_ref.uuid}@@"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":16384,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"e52890e9-d06b-4185-9e67-91dfb89457ce","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"}},"type":"","boot_type":"LEGACY","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"RHCOS47_BOOTSTRAP","uuid":"fdf77ea2-f718-45e9-b823-7b0c7fb68330"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"IDE"},"device_type":"CDROM"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"OpenshiftLB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create SubnetRef"}],"name":"8e2557a0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_substrate","name":"OpenshiftLB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create SubnetRef","attrs":{"exit_status":[],"script":"subnet_ref={\n                \"kind\": \"subnet\",\n                \"uuid\": \"@@{SUBNET_REF}@@\"\n              }\nprint 'subnet_ref=',json.dumps(subnet_ref)","eval_variables":["subnet_ref"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"34748339_runbook","main_task_local_reference":{"kind":"app_task","name":"8e2557a0_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"OpenshiftLB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"77be263b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"86ea7a14_runbook","main_task_local_reference":{"kind":"app_task","name":"77be263b_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"OpenshiftLB_DNS","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"editables":{"create_spec":{"resources":{"guest_customization":true,"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true}}},"os_type":"Linux","create_spec":{"name":"Openshift-LB-DNS-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"@@{subnet_ref.uuid}@@"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":6144,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{CRED.username}@@\n    ssh-authorized-keys:\n      - @@{CRED.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"e52890e9-d06b-4185-9e67-91dfb89457ce","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"LEGACY","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"OpenshiftC8","uuid":"673cf78e-aca8-4b12-804b-c806b9cee041"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"EXISTING_VM","name":"Prov_Check","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{OpenshiftLB_DNS.address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"@@{OpenshiftLB_DNS.address}@@"},"variable_list":[]}],"credential_definition_list":[{"username":"core","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CRED","editables":{"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Boostrap"}],"name":"Setup","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Setup"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"OS Installation"},{"kind":"app_task","name":"Remove ISO Disk"},{"kind":"app_task","name":"Status"}],"name":"5707bf52_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Remove ISO Disk"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Status"}},{"from_task_reference":{"kind":"app_task","name":"OS Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Remove ISO Disk"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"OS Installation","attrs":{"script":"#!\/bin\/bash -e\nLB_DNS_STATUS=\"@@{LB_DNS.ST}@@\"\nBOOTSTRAP_IP=\"@@{calm_array_address}@@\"\nLB_DNS_USER=\"core\"\nLB_DNS_IP=\"@@{OpenshiftLB_DNS.address}@@\"\nOPENSHIFT_SUBDOMAIN=\"@@{OPENSHIFT_SUBDOMAIN}@@\"\nBASE_DOMAIN=\"@@{BASE_DOMAIN}@@\"\nMACHINE_NETWORK=\"@@{MACHINE_NETWORK}@@\"\nRDNS_RANGE=\"${MACHINE_NETWORK%.*}\"\nREV_ZONE_RANGE=$(echo ${RDNS_RANGE} | awk -F '.' '{OFS=\".\"; print $3,$2,$1}')\n\nGW=$(ip route list dev ens3 | awk ' \/^default\/ {print $3}')\nSNM=$(\/sbin\/ifconfig ens3 | awk '\/netmask\/{ print $4;} ')\nsudo coreos-installer install \/dev\/sda --ignition-url http:\/\/@@{PROVISIONING_VM}@@:8080\/openshift\/bootstrap_@@{OPENSHIFT_SUBDOMAIN}@@.ign --insecure-ignition --firstboot-args 'ip=@@{address}@@::'$GW':'$SNM':bootstrap.@@{OPENSHIFT_SUBDOMAIN}@@.@@{BASE_DOMAIN}@@:ens3:none nameserver=@@{OpenshiftLB_DNS.address}@@'\n\nBOOTSTRAP_IP_SUFFIX=$(echo \"${BOOTSTRAP_IP}\" | cut -d '.' -f4)\n\n## Configure ssh agent\nSSH_CRED=\"@@{CRED.secret}@@\"\neval `ssh-agent -s`\nssh-add - <<<\"${SSH_CRED}\"\n\n## Update DNS zones and LB config for Bootstrap ###\nssh ${LB_DNS_USER}@${LB_DNS_IP} -o StrictHostKeyChecking=no -o UserKnownHostsFile=\/dev\/null << EOF\n# Update DNS forward lookup zone\nsudo sed -r -i '\/^bootstrap\/ s\/0.0.0.0\/'${BOOTSTRAP_IP}'\/g'  \/var\/named\/db.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}\n# Update DNS reverse lookup zone\nsudo sed -r -i 's\/^00\/'${BOOTSTRAP_IP_SUFFIX}'\/g' \/var\/named\/db.${REV_ZONE_RANGE}.in-addr.arpa\n# Update Load balancer config\nsudo sed -r -i 's\/0.0.0.0\/'${BOOTSTRAP_IP}'\/g' \/etc\/haproxy\/haproxy.cfg\n# Reload services\nsudo systemctl reload named && sudo systemctl reload haproxy\n# Update resolv.conf\necho \"nameserver ${LB_DNS_IP}\" | sudo tee \/etc\/resolv.conf\nEOF\n\n# ## Update DNS zones and LB config for Bootstrap ###\n# ssh ${LB_DNS_USER}@${LB_DNS_IP} -o StrictHostKeyChecking=no -o UserKnownHostsFile=\/dev\/null << EOF\n# # Update DNS forward lookup zone\n# sudo sed -r -i '\/bootstrap.ocp4\/ s\/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\/'${BOOTSTRAP_IP}'\/g'  \/var\/named\/ocp4.example.com.db\n# # Update DNS reverse lookup zone\n# sudo sed -r -i '\/bootstrap.ocp4\/ s\/^[0-9]+\/'${BOOTSTRAP_IP_SUFFIX}'\/g' \/var\/named\/ocp4-reverse.db\n# # Update Load balancer config\n# sudo sed -r -i '\/bootstrap\/ s\/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+(:[0-9]+)\/'${BOOTSTRAP_IP}'\\1\/g' \/etc\/haproxy\/haproxy.cfg\n# # Reload services\n# sudo systemctl reload named && sudo systemctl reload haproxy\n# EOF\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Remove ISO Disk","attrs":{"script":"JWT = '@@{calm_jwt}@@'\nvmUuid ='@@{id}@@'\n# Get VM\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\nheaders = {'Content-Type': 'application\/json',  'Accept':'application\/json', 'Authorization': 'Bearer {}'.format(JWT)}\n\nr = urlreq(api_url, verb='GET', headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n# Power off VM\ndel resp['status']\n\nresp['spec']['resources']['power_state'] = 'OFF'\n\npayload = resp\n\nr = urlreq(api_url, verb='PUT', params=json.dumps(payload), headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    taskUuid = resp['status']['execution_context']['task_uuid']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n\n# Monitor task\nstate = \"\"\nwhile state != \"SUCCEEDED\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/tasks\/{}'.format(taskUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\n# Wait for VM to power off\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\nr = urlreq(api_url, verb='GET', headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    power_state = resp['status']['resources']['power_state']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\nstate = \"\"\nwhile state != \"OFF\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']['resources']['power_state']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\n# Remove ISO and Power on VM \ndel resp['status']\n# Remove ISO mount and disk size\ndisk_counter = 0\nfor disk in resp['spec']['resources']['disk_list']:\n  del disk['disk_size_mib']\n  if disk['device_properties']['device_type'] == \"CDROM\":\n    del resp['spec']['resources']['disk_list'][disk_counter]\n  disk_counter += 1\n\n\nresp['spec']['resources']['power_state'] = 'ON'\n\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\npayload = resp\n\nr = urlreq(api_url, verb='PUT', params=json.dumps(payload), headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    taskUuid = resp['status']['execution_context']['task_uuid']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n# Monitor task\nstate = \"\"\nwhile state != \"SUCCEEDED\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/tasks\/{}'.format(taskUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\nprint(\"Removed ISO from Bootstrap and booted into Disk\")\n\n# Wait until VM boots\nsleep(60)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Boostrap"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Status","attrs":{"exit_status":[],"script":"print 'BOOTSTRAP_STATUS=Done'","eval_variables":["BOOTSTRAP_STATUS"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"20d21b90_runbook","main_task_local_reference":{"kind":"app_task","name":"5707bf52_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Setup"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a643dfca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"24fb9eac_runbook","main_task_local_reference":{"kind":"app_task","name":"a643dfca_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"OpenshiftC8","version":"","options":{"type":"","name":"OpenshiftC8","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.4.2105-20210603.0.x86_64.qcow2","version":{"product_version":"1.0.0","type":"","product_name":"Openshift-Centos8"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Master"}],"name":"OS Installation","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"OS Installation"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install RHCOS"},{"kind":"app_task","name":"Remove ISO Disk"},{"kind":"app_task","name":"Status"}],"name":"a3bc4919_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install RHCOS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Remove ISO Disk"}},{"from_task_reference":{"kind":"app_task","name":"Remove ISO Disk"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Status"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install RHCOS","attrs":{"script":"#!\/bin\/bash -e\nBOOTSTRAP_STATUS=\"@@{Boostrap.BOOTSTRAP_STATUS}@@\"\nMASTER_IP_MACRO=\"@@{calm_array_address}@@\"\nMASTER_IP_ARRAY=(${MASTER_IP_MACRO\/\/,\/ })\nARRAY_INDEX=\"@@{calm_array_index}@@\"\nOPENSHIFT_SUBDOMAIN=\"@@{OPENSHIFT_SUBDOMAIN}@@\"\nBASE_DOMAIN=\"@@{BASE_DOMAIN}@@\"\nMACHINE_NETWORK=\"@@{MACHINE_NETWORK}@@\"\nRDNS_RANGE=\"${MACHINE_NETWORK%.*}\"\nREV_ZONE_RANGE=$(echo ${RDNS_RANGE} | awk -F '.' '{OFS=\".\"; print $3,$2,$1}')\nLB_DNS_IP=\"@@{OpenshiftLB_DNS.address}@@\"\nLB_DNS_USER=\"core\"\nGW=$(ip route list dev ens3 | awk ' \/^default\/ {print $3}')\nSNM=$(\/sbin\/ifconfig ens3 | awk '\/netmask\/{ print $4;} ')\n\n# Configure ssh agent\nSSH_CRED=\"@@{CRED.secret}@@\"\neval `ssh-agent -s`\nssh-add - <<<\"${SSH_CRED}\"\n\nsudo coreos-installer install \/dev\/sda --ignition-url http:\/\/@@{PROVISIONING_VM}@@:8080\/openshift\/master_@@{OPENSHIFT_SUBDOMAIN}@@.ign --insecure-ignition --firstboot-args 'ip=@@{address}@@::'$GW':'$SNM':master@@{calm_array_index}@@.@@{OPENSHIFT_SUBDOMAIN}@@.@@{BASE_DOMAIN}@@:ens3:none nameserver=@@{OpenshiftLB_DNS.address}@@'\n\nif [ ${ARRAY_INDEX} -eq 0 ]; then\n\n# SSH to LB\/DNS server and update records\nfor i in \"${!MASTER_IP_ARRAY[@]}\"; do\nMASTER_IP_SUFFIX=$(echo \"${MASTER_IP_ARRAY[$i]}\" | cut -d '.' -f4)\nssh ${LB_DNS_USER}@${LB_DNS_IP} -o StrictHostKeyChecking=no -o UserKnownHostsFile=\/dev\/null << EOF\n# Update DNS forward lookup zone\nsudo sed -r -i '\/^master|^etcd\/ s\/1.0.0.'${i}'\/'${MASTER_IP_ARRAY[$i]}'\/g' \/var\/named\/db.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}\n# Update DNS reverse lookup zone\nsudo sed -r -i 's\/^1'${i}'\/'${MASTER_IP_SUFFIX}'\/g' \/var\/named\/db.${REV_ZONE_RANGE}.in-addr.arpa\n# Update Load balancer config\nsudo sed -r -i 's\/1.0.0.'${i}'\/'${MASTER_IP_ARRAY[$i]}'\/g' \/etc\/haproxy\/haproxy.cfg\nif [ ${i} -eq 2 ]; then\nsudo systemctl reload named && sudo systemctl reload haproxy\nfi\nEOF\ndone\nfi\n\n# # SSH to LB\/DNS server and update records\n# for i in \"${!MASTER_IP_ARRAY[@]}\"; do\n# MASTER_IP_SUFFIX=$(echo \"${MASTER_IP_ARRAY[$i]}\" | cut -d '.' -f4)\n# ssh ${LB_DNS_USER}@${LB_DNS_IP} -o StrictHostKeyChecking=no -o UserKnownHostsFile=\/dev\/null << EOF\n# # Update DNS forward lookup zone\n# sudo sed -r -i '\/master'${i}'.ocp4\/ s\/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\/'${MASTER_IP_ARRAY[$i]}'\/g'  \/var\/named\/ocp4.example.com.db\n# # Update DNS reverse lookup zone\n# sudo sed -r -i '\/master'${i}'.ocp4\/ s\/^[0-9]+\/'${MASTER_IP_SUFFIX}'\/g' \/var\/named\/ocp4-reverse.db\n# # Update Load balancer config\n# sudo sed -r -i '\/master'${i}'\/ s\/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+(:[0-9]+)\/'${MASTER_IP_ARRAY[$i]}'\\1\/g' \/etc\/haproxy\/haproxy.cfg\n# if [ ${i} -eq 2 ]; then\n# sudo systemctl reload named && sudo systemctl reload haproxy\n# fi\n# EOF\n# done\n# fi\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Remove ISO Disk","attrs":{"script":"JWT = '@@{calm_jwt}@@'\nvmUuid ='@@{id}@@'\n# Get VM\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\nheaders = {'Content-Type': 'application\/json',  'Accept':'application\/json', 'Authorization': 'Bearer {}'.format(JWT)}\n\nr = urlreq(api_url, verb='GET', headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n# Power off VM\ndel resp['status']\n\nresp['spec']['resources']['power_state'] = 'OFF'\n\npayload = resp\n\nr = urlreq(api_url, verb='PUT', params=json.dumps(payload), headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    taskUuid = resp['status']['execution_context']['task_uuid']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n\n# Monitor task\nstate = \"\"\nwhile state != \"SUCCEEDED\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/tasks\/{}'.format(taskUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\n# Wait for VM to power off\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\nr = urlreq(api_url, verb='GET', headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    power_state = resp['status']['resources']['power_state']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\nstate = \"\"\nwhile state != \"OFF\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']['resources']['power_state']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\n# Remove ISO and Power on VM \ndel resp['status']\n# Remove ISO mount and disk size\ndisk_counter = 0\nfor disk in resp['spec']['resources']['disk_list']:\n  del disk['disk_size_mib']\n  if disk['device_properties']['device_type'] == \"CDROM\":\n    del resp['spec']['resources']['disk_list'][disk_counter]\n  disk_counter += 1\n\n\nresp['spec']['resources']['power_state'] = 'ON'\n\napi_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/vms\/{}'.format(vmUuid)\npayload = resp\n\nr = urlreq(api_url, verb='PUT', params=json.dumps(payload), headers=headers, verify=False)\nif r.ok:\n    resp = json.loads(r.content)\n    taskUuid = resp['status']['execution_context']['task_uuid']\n\nelse:\n    print(\"Post request failed\", r.content)\n    exit(1)\n\n# Monitor task\nstate = \"\"\nwhile state != \"SUCCEEDED\":\n    api_url = 'https:\/\/localhost:9440\/api\/nutanix\/v3\/tasks\/{}'.format(taskUuid)\n\n    sleep(2)\n    r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n    if r.ok:\n        resp = json.loads(r.content)\n        state = resp['status']\n        if state == \"FAILED\":\n            print(\"Task failed\", resp['progress_message'])\n            exit(1)\n\n    else:\n        print(\"Post request failed\", r.content)\n        exit(1)\n\nprint(\"Removed ISO from Bootstrap and booted into Disk\")\n\n# Wait until VM boots\nsleep(60)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Status","attrs":{"exit_status":[],"script":"print \"MASTER_STATUS=Done\"","eval_variables":["MASTER_STATUS"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"e4f956ad_runbook","main_task_local_reference":{"kind":"app_task","name":"a3bc4919_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"OS Installation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"22442950_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3cae7b50_runbook","main_task_local_reference":{"kind":"app_task","name":"22442950_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"LB_DNS"}],"name":"Openshift LB DNS Setup","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Openshift LB DNS Setup"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Provisioning Setup"},{"kind":"app_task","name":"DNS Server Setup"},{"kind":"app_task","name":"Haproxy Setup"},{"kind":"app_task","name":"Status"}],"name":"a68d3d79_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Provisioning Setup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"DNS Server Setup"}},{"from_task_reference":{"kind":"app_task","name":"DNS Server Setup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Haproxy Setup"}},{"from_task_reference":{"kind":"app_task","name":"Haproxy Setup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Status"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Provisioning Setup","attrs":{"script":"#!\/bin\/bash -e\n\n# Get machine IP\nMACHINE_IP=\"@@{OpenshiftLB_DNS.address}@@\"\nSSH_USER=\"@@{CRED.username}@@\"\n\n# Inject ssh key pair into the VM for provisioning support\nmkdir -m 700 -p ~\/.ssh\ncat <<EOF >~\/.ssh\/id_rsa\n@@{CRED.secret}@@\nEOF\nchmod 600 ~\/.ssh\/id_rsa\ncat <<EOF > ~\/.ssh\/id_rsa.pub\n@@{CRED.public_key}@@\nEOF\n\n# Env setup\nmkdir -p openshift\ncd openshift\n\n# Use rackspace repo mirrors\n# Temporary bypass for centos mirror list issue which cropped up today\nls \/etc\/yum.repos.d | while read i; do\nsudo sed -i '\/mirrorlist.centos.org\/d' \/etc\/yum.repos.d\/\"${i}\"\nsudo sed -i -r '\/^#baseurl\/ s\/#(baseurl)\/\\1\/g;s\/mirror.centos.org\/mirror.rackspace.com\/g' \/etc\/yum.repos.d\/\"${i}\"\ndone\n\n# Install dependencies\n# sudo yum -y update\nsudo yum -y install jq haproxy bind python3\n\n# Disable selinux\nsudo setenforce 0\nsudo sed -i.bkp -r 's\/(SELINUX=)enforcing\/\\1disabled\/g;s\/^SELINUXTYPE=targeted\/#&\/g' \/etc\/selinux\/config\n\n# Download Openshift installer\ncurl -o openshift-install-linux.tar.gz https:\/\/mirror.openshift.com\/pub\/openshift-v4\/clients\/ocp\/stable-4.7\/openshift-install-linux.tar.gz\ntar xzf openshift-install-linux.tar.gz\nsudo install -m 755 -o root openshift-install \/sbin\/\n\n### Disabled temporarily since a different provisioning VM is used ###\n## Download coreos-installer\n# curl -o coreos-installer https:\/\/mirror.openshift.com\/pub\/openshift-v4\/clients\/coreos-installer\/latest\/coreos-installer\n# sudo install -m 755 -o root coreos-installer \/sbin\/\n\n# Download Openshift client\ncurl -o openshift-client-linux.tar.gz https:\/\/mirror.openshift.com\/pub\/openshift-v4\/clients\/ocp\/stable\/openshift-client-linux.tar.gz\ntar xzf openshift-client-linux.tar.gz\nsudo install -m 755 -o root oc \/sbin\/\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DNS Server Setup","attrs":{"script":"#!\/bin\/bash -xe\n\nMACHINE_IP=\"@@{OpenshiftLB_DNS.address}@@\"\nMACHINE_NETWORK=\"@@{MACHINE_NETWORK}@@\"\nOPENSHIFT_SUBDOMAIN=\"@@{OPENSHIFT_SUBDOMAIN}@@\"\nBASE_DOMAIN=\"@@{BASE_DOMAIN}@@\"\nRDNS_RANGE=\"${MACHINE_NETWORK%.*}\"\n#REV_ZONE_RANGE=$(python3 -c 'print((\".\").join(\"'${RDNS_RANGE}'\".split(\".\")[::-1]))')\nREV_ZONE_RANGE=$(echo ${RDNS_RANGE} | awk -F '.' '{OFS=\".\"; print $3,$2,$1}')\nMACHINE_IP_SUFFIX=\"${MACHINE_IP##*.}\"\n\n### Bind DNS server configuration ###\n# Create forward and reverse lookup zones for Openshift\ncat <<EOF | sudo tee -a \/etc\/named.conf\nzone \"@@{BASE_DOMAIN}@@\" IN {\n        type master;\n        file \"db.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}\";\n};\n\n\nzone \"${REV_ZONE_RANGE}.in-addr.arpa\" IN {\n        type master;\n        file \"db.${REV_ZONE_RANGE}.in-addr.arpa\";\n};\nEOF\n\n# Listen on all interfaces\nsudo sed -i '\/listen-on port 53\/ s\/127.0.0.1\/any\/g' \/etc\/named.conf\n# Allow DNS lookup from all IPs\nsudo sed -i '\/allow-query\/ s:localhost:any:g' \/etc\/named.conf\n\n# # Allow DNS lookup from all IPs in MACHINE_NETWORK range\n# sudo sed -i '\/allow-query\/ s:localhost:'${MACHINE_NETWORK}':g' \/etc\/named.conf\n\n# Set forwarders for lookup of external zones\n# Defaults to Google nameservers\ncat <<EOF > \/tmp\/forwarders.txt\n        \/\/ Set forwarders to DNS zone\n        forwarders {\n                @@{DNS_FORWARDER}@@;\n        };\nEOF\nsudo sed -i.bkp '\/recursion yes\/r \/tmp\/forwarders.txt' \/etc\/named.conf\n\n# Create forward lookup zone templates\ncat <<EOF | sudo tee \/var\/named\/db.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}\n\\$TTL 1W\n@   IN  SOA ns1.${BASE_DOMAIN}.    root (\n            2019070703  ; serial\n            3H      ; refresh (3 hours)\n            30M     ; retry (30 minutes)\n            2W      ; expiry (2 weeks)\n            1W )        ; minimum (1 week)\n    IN  NS  ns1.${BASE_DOMAIN}.\n;\n;\nns1 IN  A   ${MACHINE_IP}\n;\nhelper  IN  A   ${MACHINE_IP}\nhelper.${OPENSHIFT_SUBDOMAIN} IN  A   ${MACHINE_IP}\n;\n; The api points to the IP of your load balancer\napi.${OPENSHIFT_SUBDOMAIN}        IN  A   ${MACHINE_IP}\napi-int.${OPENSHIFT_SUBDOMAIN}        IN  A   ${MACHINE_IP}\n;\n; The wildcard also points to the load balancer\n*.apps.${OPENSHIFT_SUBDOMAIN}     IN  A   ${MACHINE_IP}\n;\n; Bootstrap host\nbootstrap.${OPENSHIFT_SUBDOMAIN}  IN  A   0.0.0.0\n; Master hosts\nmaster0.${OPENSHIFT_SUBDOMAIN}        IN  A   1.0.0.0\nmaster1.${OPENSHIFT_SUBDOMAIN}        IN  A   1.0.0.1\nmaster2.${OPENSHIFT_SUBDOMAIN}        IN  A   1.0.0.2\n;\n; Worker hosts\n; worker0.${OPENSHIFT_SUBDOMAIN}        IN  A   2.0.0.0\n; worker1.${OPENSHIFT_SUBDOMAIN}        IN  A   2.0.0.1\n;\n; The ETCd cluster lives on the masters\netcd-0.${OPENSHIFT_SUBDOMAIN} IN  A   1.0.0.0\netcd-1.${OPENSHIFT_SUBDOMAIN} IN  A   1.0.0.1\netcd-2.${OPENSHIFT_SUBDOMAIN} IN  A   1.0.0.2\n;\n; SRV records\n_etcd-server-ssl._tcp.${OPENSHIFT_SUBDOMAIN}  IN  SRV 0 10 2380 etcd-0.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n_etcd-server-ssl._tcp.${OPENSHIFT_SUBDOMAIN}  IN  SRV 0 10 2380 etcd-1.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n_etcd-server-ssl._tcp.${OPENSHIFT_SUBDOMAIN}  IN  SRV 0 10 2380 etcd-2.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\nEOF\n\ncat <<EOF | sudo tee \/var\/named\/db.${REV_ZONE_RANGE}.in-addr.arpa\n\\$TTL 1W\n@   IN  SOA ns1.${BASE_DOMAIN}.    root (\n            2019070700  ; serial\n            3H      ; refresh (3 hours)\n            30M     ; retry (30 minutes)\n            2W      ; expiry (2 weeks)\n            1W )        ; minimum (1 week)\n    IN  NS  ns1.${BASE_DOMAIN}.\n;\n; syntax is \"last octet\" and the host must have fqdn with trailing dot\n10  IN  PTR master0.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n11  IN  PTR master1.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n12  IN  PTR master2.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n;\n00  IN  PTR bootstrap.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n;\n${MACHINE_IP_SUFFIX}  IN  PTR api.${OPENSHIFT_SUBDOMAIN}.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n${MACHINE_IP_SUFFIX}   IN  PTR api-int.${OPENSHIFT_SUBDOMAIN}.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n;\n;20  IN  PTR worker0.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\n;21  IN  PTR worker1.${OPENSHIFT_SUBDOMAIN}.${BASE_DOMAIN}.\nEOF\n\n# Enable bind on startup\nsudo systemctl enable named\nsudo systemctl start named\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Haproxy Setup","attrs":{"script":"#!\/bin\/bash -xe\n\n# Inject haproxy config template\ncat << EOF | sudo tee -a \/etc\/haproxy\/haproxy.cfg\n#---------------------------------------------------------------------\n# Openshift config\n#---------------------------------------------------------------------\n\nlisten stats\n    bind :9000\n    mode http\n    stats enable\n    stats uri \/\n    monitor-uri \/healthz\n\n\nfrontend openshift-api-server\n    bind *:6443\n    default_backend openshift-api-server\n    mode tcp\n    option tcplog\n\nbackend openshift-api-server\n    balance source\n    mode tcp\n    server bootstrap 0.0.0.0:6443 check # Disable after provisioning\n    server master0 1.0.0.0:6443 check\n    server master1 1.0.0.1:6443 check\n    server master2 1.0.0.2:6443 check\n\nfrontend machine-config-server\n    bind *:22623\n    default_backend machine-config-server\n    mode tcp\n    option tcplog\n\nbackend machine-config-server\n    # Don't add masters since initial config is seeded from bootstrap\n    balance source\n    mode tcp\n    server bootstrap 0.0.0.0:22623 check\n\nfrontend ingress-http\n    bind *:80\n    default_backend ingress-http\n    mode tcp\n    option tcplog\n\nbackend ingress-http\n    balance source\n    mode tcp\n    # server worker0 2.0.0.0:80 check\n    # server worker1 2.0.0.1:80 check\n    server master0 1.0.0.0:80 check\n    server master1 1.0.0.1:80 check\n    server master2 1.0.0.2:80 check\n\nfrontend ingress-https\n    bind *:443\n    default_backend ingress-https\n    mode tcp\n    option tcplog\n\nbackend ingress-https\n    balance source\n    mode tcp\n    # server worker0 2.0.0.0:443 check\n    # server worker1 2.0.0.1:443 check\n    server master0 1.0.0.0:443 check\n    server master1 1.0.0.1:443 check\n    server master2 1.0.0.2:443 check\nEOF\n\nsudo systemctl enable haproxy\nsudo systemctl start haproxy\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"LB_DNS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Status","attrs":{"exit_status":[],"script":"print 'ST=@@{OPENSHIFT_SUBDOMAIN}@@'","eval_variables":["ST"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"39671816_runbook","main_task_local_reference":{"kind":"app_task","name":"a68d3d79_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Openshift LB DNS Setup"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ee7f5a7a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2ca5fd92_runbook","main_task_local_reference":{"kind":"app_task","name":"ee7f5a7a_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"RHCOS47_BOOTSTRAP","version":"","options":{"type":"","name":"RHCOS-@@{OPENSHIFT_SUBDOMAIN}@@","resources":{"image_type":"ISO_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/@@{PROVISIONING_VM}@@:8080\/openshift\/rhcos-@@{OPENSHIFT_SUBDOMAIN}@@.iso","version":{"product_version":"1.0.0","type":"","product_name":"RHCOS47_BOOTSTRAP"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"OS_Status_Check"}],"name":"Check Openshift status","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Check Openshift status"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Prepare Install"},{"kind":"app_task","name":"Check Openshift Status"}],"name":"5607dede_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Prepare Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Check Openshift Status"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Prepare Install","attrs":{"exit_status":[],"script":"mkdir -p openshift\/auth\ncd openshift\/auth\necho @@{KUBECONFIGB64}@@ | base64 -d > kubeconfig\necho @@{KUBEADMINB64}@@ | base64 -d > kubeadmin-password","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Check Openshift Status","attrs":{"script":"#!\/bin\/bash -e\n# Use macro from master set var task to delay task execution\nMASTER_STATUS=\"@@{Master.MASTER_STATUS}@@\"\n\ncd openshift\n# Wait for bootstrap completion\nsudo openshift-install wait-for bootstrap-complete --log-level debug\n# Remove bootstrap entry from haproxy and reload haproxy\nsudo sed -i '\/server bootstrap.*:6443\/ s\/server\/#&\/g' \/etc\/haproxy\/haproxy.cfg\nsudo systemctl reload haproxy\n# Wait for openshift installation to complete\nsudo openshift-install wait-for install-complete --log-level debug","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e460ecb2_runbook","main_task_local_reference":{"kind":"app_task","name":"5607dede_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Check Openshift status"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3200b001_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8eff546d_runbook","main_task_local_reference":{"kind":"app_task","name":"3200b001_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"decb8265_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Setup"}],"substrate_local_reference":{"kind":"app_substrate","name":"bootstrap"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"9df14f84_deployment","min_replicas":"3","default_replicas":"3","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"3","package_local_reference_list":[{"kind":"app_package","name":"OS Installation"}],"substrate_local_reference":{"kind":"app_substrate","name":"master"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"8ff9c0f1_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Openshift LB DNS Setup"}],"substrate_local_reference":{"kind":"app_substrate","name":"OpenshiftLB_DNS"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"d9d0f80c_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Check Openshift status"}],"substrate_local_reference":{"kind":"app_substrate","name":"Prov_Check"},"variable_list":[],"description":""}],"environment_reference_list":[],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Deploy CSI Driver"}],"name":"425a1dab_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Deploy CSI Driver","attrs":{"exit_status":[],"script":"export KUBECONFIG=~\/openshift\/auth\/kubeconfig\necho \"\"\"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: ntnx-system\nstringData:\n  key: @@{PE_IP}@@:9440:@@{PE_ADMIN}@@:@@{PE_PW}@@\"\"\" > ntnx-secret.yaml\necho \"\"\"apiVersion: operators.coreos.com\/v1\nkind: OperatorGroup\nmetadata:\n  name: ntnx-system-r8czl\n  namespace: ntnx-system\nspec:\n  targetNamespaces:\n  - ntnx-system\"\"\" > operatorgroup.yaml\necho \"\"\"apiVersion: operators.coreos.com\/v1alpha1\nkind: Subscription\nmetadata:\n  name: nutanixcsioperator\n  namespace: ntnx-system\nspec:\n  channel: beta\n  name: nutanixcsioperator\n  installPlanApproval: Automatic\n  source: certified-operators\n  sourceNamespace: openshift-marketplace\"\"\" > subscription.yaml\necho \"\"\"apiVersion: crd.nutanix.com\/v1alpha1\nkind: NutanixCsiStorage\nmetadata:\n  name: nutanixcsistorage\n  namespace: ntnx-system\nspec:\n  namespace: ntnx-system\"\"\" > instance.yaml\n  \noc create ns ntnx-system\noc create -f ntnx-secret.yaml\noc create -f operatorgroup.yaml\noc create -f subscription.yaml\n\nATTEMPTS=0\nROLLOUT_STATUS_CMD=\"oc wait --for=condition=available --timeout=120s -n ntnx-system deployments nutanix-csi-operator-controller-manager\"\nuntil $ROLLOUT_STATUS_CMD || [ $ATTEMPTS -eq 12 ]; do\n  $ROLLOUT_STATUS_CMD\n  ATTEMPTS=$((attempts + 1))\n  sleep 10\ndone\n\n# Check deployment rollout status every 10 seconds (max 2 minutes) until complete.\nATTEMPTS=0\nROLLOUT_STATUS_CMD=\"oc get NutanixCsiStorage -n ntnx-system\"\nuntil $ROLLOUT_STATUS_CMD || [ $ATTEMPTS -eq 12 ]; do\n  $ROLLOUT_STATUS_CMD\n  ATTEMPTS=$((attempts + 1))\n  sleep 10\ndone\n\noc create -f instance.yaml","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"87f0cf03_runbook","main_task_local_reference":{"kind":"app_task","name":"425a1dab_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"PE_PW","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PE_ADMIN","value":"admin","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PE_IP","value":"10.38.15.135","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"Deploy CSI"},{"description":"Enables Image Registry on 100G Nutanix Volume (not for Production Usage)","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Enable Image Registry"}],"name":"980b7dff_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"OS_Status_Check"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Enable Image Registry","attrs":{"exit_status":[],"script":"export KUBECONFIG=~\/openshift\/auth\/kubeconfig\necho \"\"\"apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: nutanix-volume\nprovisioner: csi.nutanix.com\nparameters:\n  csi.storage.k8s.io\/provisioner-secret-name: ntnx-secret\n  csi.storage.k8s.io\/provisioner-secret-namespace: ntnx-system\n  csi.storage.k8s.io\/node-publish-secret-name: ntnx-secret\n  csi.storage.k8s.io\/node-publish-secret-namespace: ntnx-system\n  csi.storage.k8s.io\/controller-expand-secret-name: ntnx-secret\n  csi.storage.k8s.io\/controller-expand-secret-namespace: ntnx-system\n  csi.storage.k8s.io\/fstype: ext4\n  dataServiceEndPoint: @@{DS_IP}@@:3260\n  storageContainer: @@{PE_CONTAINER}@@\n  storageType: NutanixVolumes\n  #whitelistIPMode: ENABLED\n  #chapAuth: ENABLED\nallowVolumeExpansion: true\nreclaimPolicy: Delete\"\"\" > storageclass.yaml\necho \"\"\"kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: image-registry-claim\n  namespace: openshift-image-registry\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 100Gi\n  storageClassName: nutanix-volume\"\"\" > pvc.yaml\n\noc create -f storageclass.yaml\noc create -f pvc.yaml\n\n# Patch OC Image Registry to use created PVC\noc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{\"spec\":{\"managementState\":\"Managed\",\"storage\":{\"pvc\":{\"claim\":\"image-registry-claim\"}},\"rolloutStrategy\": \"Recreate\"}}'\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4df6387a_runbook","main_task_local_reference":{"kind":"app_task","name":"980b7dff_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DS_IP","value":"10.38.15.136","label":"DataServiceIP","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PE_CONTAINER","value":"Default","label":"Storage Container","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"Enable Image Registry"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BASE_DOMAIN","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"OPENSHIFT_SUBDOMAIN","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DNS_FORWARDER","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"PROVISIONING_VM","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MACHINE_NETWORK","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"KUBECONFIGB64","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"KUBEADMINB64","value":"","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"SUBNET_REF","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CRED"},"type":"USER"},"name":"OCP-Dev"},"api_version":"3.0","metadata":{"last_update_time":"1628772941570637","kind":"blueprint","spec_version":5,"creation_time":"1628745120357397","name":"OCP-Dev"}}